define(function(require,exports,module){require("http://www.fe2base.com/wp-content/views/private/simulation-select/css/scrollbar.css");require("http://www.fe2base.com/wp-content/views/private/simulation-select/css/style.css");var lib=require("http://www.fe2base.com/wp-content/views/public/dist/lib.js");require("http://www.fe2base.com/wp-content/views/private/simulation-select/dist/jquery.scrollbar.js");var _seltodivHtml=["<div {thisAttrs}>",'<div class="head">','<div class="left"><ul></ul>','<input type="text" class="txt-val" value="{texVal}" />',"</div>",'<div class="right">','<a href="#" class="down"><s class="default"></s></a>',"</div>","</div>",'<div class="select-list">','<div class="scrollbarObj">',"<ol>{liStr}</ol>","</div>","</div>","</div>"],_multipleChoiceItem='<a herf="#" class="chk-multiple-choice"></a>{text}',_multipleChoiceTopItem='<li class="multiple-choice-item" _value="{_value}" ><span>{text}</span><a href="javascript:void(0);" class="multiplechoicetopitem-delete"></a></li>',_itemHtml='<li class="item" _value="{_value}" val="{_val}"  {attrs} ><div class="item-text">{text}</div></li>';var _fineTuning=function(thiswidth){var self=this,$this=$(this),_selectListObj,_rightObj,_rightObjW;if(thiswidth){_rightObjW=$this.find(".right").innerWidth();$this.css("width",thiswidth);$this.find(".left").css("width",parseFloat(thiswidth-10));$this.find(".txt-val").css("width",parseFloat(thiswidth-_rightObjW-10));$this.find(".select-list").css("right",-1);setTimeout(function(){initScrollbar.call(self)},2)}else{_selectListObj=$this.find(".select-list");_rightObj=$this.find(".right");_rightObjW=_rightObj.innerWidth();_selectListObj.css("right","auto");$this.css("width",_selectListObj.innerWidth()+_rightObjW+4);$this.find(".txt-val").css("width",parseFloat($this.innerWidth()-_rightObjW-10));_selectListObj.css("right",-1);setTimeout(function(){initScrollbar.call(self)},20)}};var _eachText=function(_v){this.find("em.key").each(function(){var _this=$(this);_this.replaceWith(_this.html())});this.closest(".item").removeClass("hide");if(!_v.length){return}try{var _itemHtml=$.trim(this.html()),_itemText=$.trim(this.text()),_itemTextR=_itemText.replace(eval("/"+_v+"/g"),'<em class="key">'+_v+"</em>"),_itemHtmlR=_itemHtml.replace(eval("/>"+_itemText+"</g"),">"+_itemTextR+"<"),_itemHtmlR=_itemHtmlR.replace(eval("/>"+_itemText+"/g"),">"+_itemTextR),_itemHtmlR=_itemHtmlR.replace(eval("/"+_itemText+"</g"),_itemTextR+"<");if(_itemText===_itemTextR){this.closest(".item").addClass("hide")}else{if(_itemHtml===_itemText){this.html(_itemTextR)}else{this.html(_itemHtmlR)}}}catch(e){throw"无法匹配[]+-|?()等正则匹配符，此BUG将在未来得以解决"}};var _keyCode3840={"38":function(){this.find("a.down").click();var _ched=this.find(".item.ched");var _prev=this.find(".item.ched").prevAll(".item:not(.hide):eq(0)");if(!_prev.length){_prev=this.find(".item:not(.hide):last")}_ched.removeClass("ched");_prev.addClass("ched");this.find(".txt-val").val(_prev.attr("_value"));return _prev},"40":function(){this.find("a.down").click();var _ched=this.find(".item.ched");var _next=this.find(".item.ched").nextAll(".item:not(.hide):eq(0)");if(!_next.length){_next=this.find(".item:not(.hide):first")}_ched.removeClass("ched");_next.addClass("ched");this.find(".txt-val").val(_next.attr("_value"));return _next}};var _delegate=function(){var self=this,$this=this instanceof jQuery?this:$(this);$this.delegate("a.down","click",function(event){var _this=$(this),_seltodiv=_this.closest(".seltodiv"),_selectList=_seltodiv.find(".select-list");$(".seltodiv.down").removeClass("down");if(_isReachBottom.call(_seltodiv)){_selectList.css("top",-(_selectList.innerHeight())-2)}else{_selectList.css("top",_seltodiv.innerHeight())}_seltodiv.toggleClass("down");event.preventDefault();event.stopPropagation()});$this.delegate("a.down","click",function(event){var _this=$(this),_seltodiv=_this.closest(".seltodiv"),_thisVal=_seltodiv.find(".txt-val").val();_seltodiv.find(".ched").removeClass("ched");if(_seltodiv.hasClass("down")&&_thisVal){var ched=_seltodiv.find(".item[val='"+_thisVal+"']:eq(0)");ched.addClass("ched")}_this.closest(".seltodiv").prev("select.seltodiv").click();event.preventDefault();event.stopPropagation()});$this.delegate("li.item","click",function(event){var _item=$(this),_seltodiv=_item.closest(".seltodiv");if(_seltodiv.find(".txt-val").val()!=$.trim(_item.text())){_seltodiv.find(".txt-val").val($.trim(_item.text()));_seltodiv.prev("select").val(_item.attr("_value"));_seltodiv.prev("select.seltodiv").change()}_seltodiv.removeClass("down");event.stopPropagation()});$this.delegate(".scrollbar","click",function(event){event.preventDefault();event.stopPropagation()});$this.delegate(".txt-val","keyup",function(e){var _this=$(this),_v=_this.val(),_keyCode=e.keyCode,test;test=_keyCode>=48&&_keyCode<=57;test=test||_keyCode>=65&&_keyCode<=90;test=test||_keyCode>=96&&_keyCode<=105;test=test||(_keyCode==106||_keyCode==107||_keyCode==109||_keyCode==110||_keyCode==111);test=test||(_keyCode==8||_keyCode==32||_keyCode==186||_keyCode==187||_keyCode==188||_keyCode==189||_keyCode==190||_keyCode==191);test=test||(_keyCode==219||_keyCode==221||_keyCode==220||_keyCode==222);if(test){$this.find("a.down").click();$this.find(".item-text").each(function(){var self=$(this);_eachText.call(self,_v)});rsetScrollbar.call($this,($this.attr("_rows")-0)||10)}if(typeof _keyCode3840[_keyCode]==="function"){var _ched=_keyCode3840[_keyCode].call($this);var _height=_ched.innerHeight(),_scrollbar_handle,_scrollerWarp,_top;_scrollerWarp=$this.find(".scroll_wrap");_scrollbar_handle=$this.find(".scrollbar_handle");_top=_ched.position().top;if(_top>=_scrollerWarp.innerHeight()){_scrollerWarp.scrollTop(_scrollerWarp.scrollTop()+(_top+_height-_scrollerWarp.innerHeight()));if(parseInt(_scrollbar_handle.css("top"))+parseInt(_scrollbar_handle.innerHeight())<=_scrollerWarp.innerHeight()){_scrollbar_handle.css("top",_scrollerWarp.innerHeight()-_scrollbar_handle.innerHeight())}}if(_top<=0){_scrollerWarp.scrollTop(_scrollerWarp.scrollTop()+parseInt(_top-_height));_scrollbar_handle.css("top",parseInt(_scrollbar_handle.css("top"))-_scrollerWarp.innerHeight()/6<=0?0:parseInt(_scrollbar_handle.css("top"))-_scrollerWarp.innerHeight()/6)}}})};var _init=function(){var $this=this.constructor==jQuery?this:$(this);if(!$this.next("div.seltodiv").length){var _outerHTML=$.trim($this.get(0).outerHTML.split(">")[0]),thisAttrs=_outerHTML[1]==="s"?_outerHTML.split("<select").join(""):_outerHTML.split("<SELECT").join(""),liArr=[];var itemObj={_value:"",_val:"",text:""};$this.find("option").each(function(i){var _option=$(this);itemObj._value=_option.attr("value");itemObj._val=$.trim(_option.html());itemObj.text=$.trim(_option.html());itemObj.attrs=_option.attr("disabled")?'_disabled="_disabled"':"";liArr.push(lib.Replace(_itemHtml,itemObj))});var obj={texVal:$this.find("option:selected").length>0?$.trim($this.find("option:selected").html()):$.trim($this.find("option:eq(0)").html()),thisAttrs:thisAttrs,liStr:liArr.join("")};var seltodiv=$(lib.Replace(_seltodivHtml.join(""),obj));if(seltodiv.attr("id")){seltodiv.attr("id",seltodiv.attr("id")+"_inst")}seltodiv.addClass("instdiv");$this.css("display","none").after(seltodiv);_fineTuning.call(seltodiv);setTimeout(function(){_delegate.call(seltodiv)},5)}};var initScrollbar=function(){var self=$(this);var _height=self.find(".scrollbarObj li.item:eq(0)").innerHeight(),_thisVal=self.find(".txt-val").val(),_scroll_wrap,_scrollbar_handle,_top,_contentH,_ched;var setCssObj={overflow:"hidden",height:(_height*10)+"px"};self.find(".select-list").css(setCssObj);self.find(".scrollbarObj").css(setCssObj).scrollbar({});_scroll_wrap=self.find(".scroll_wrap");_scrollbar_handle=self.find(".scrollbar_handle");_contentH=_height*(self.find(".scrollbarObj li.item").length+3);if(_thisVal){_ched=self.find(".item[val='"+_thisVal+"']:eq(0)");_top=_ched.position().top;_scroll_wrap.scrollTop(0);_scroll_wrap.scrollTop(_top-_height*2);_scrollbar_handle.css("top",parseInt(_top/_contentH*_height*10))}};var rsetScrollbar=function(showRows){var self=this,$this=$(this),_scrollbarObj,_height=$this.find(".item:eq(0)").innerHeight();_scrollbarObj=$this.find(".scrollbarObj");$this.find(".select-list").height(_height*showRows);_scrollbarObj.height(_height*showRows);_scrollbarObj.scrollbar("insertBar")};var _isReachBottom=function(){var self=this,$this=$this=this instanceof jQuery?this:$(this),$window=$(window),_windowH=$window.height(),_scrollTop=document.body.scrollTop||document.documentElement.scrollTop||window.pageYOffset,_offset=$this.offset(),_selectList=$this.find(".select-list");return _windowH+_scrollTop-_offset.top<_selectList.innerHeight()};var sdSelect=function(options){var _options={};_options.element=options;var that=_options.element.constructor==jQuery?_options.element:$(_options.element),self=this;this.$=that;this.init=function(datalist){var _init=function(_datalist){var self=this;var _sdSelect=new sdSelect(this);if(_datalist.listData){_sdSelect.$.find(".item").each(function(index){var _this=$(this),$itemtext=_this.find(".item-text");if(_datalist.listData[index].after){$itemtext.append(_datalist.listData[index].after)}if(_datalist.listData[index].before){$itemtext.prepend(_datalist.listData[index].before)}});_fineTuning.call(_sdSelect.$)}if(datalist.isMultipleChoice===true){_sdSelect.setMultipleChoice(_datalist.multipleChoiceChangeBallback)}if(datalist.width){_fineTuning.call(_sdSelect.$,datalist.width)}if(typeof datalist.disabledClickCallback==="function"){_sdSelect.$.find(".item[_disabled]").click(function(event){datalist.disabledClickCallback({value:$(this).attr("_value"),text:$(this).attr("val")});event.preventDefault();event.stopPropagation()})}if(datalist.skinName){_sdSelect.$.addClass(datalist.skinName)}setTimeout(function(){rsetScrollbar.call(self,(datalist.showRows-0)||10)},80)};that.each(function(){var _self=this;setTimeout(function(){_init.call(_self,datalist)},20)})};this.setShowRows=function(showRows){that.each(function(){var _self=this,$this=$(this);if($this.find(".item").length>showRows){setTimeout(function(){rsetScrollbar.call(_self,(showRows-0)||10)},400)}else{setTimeout(function(){rsetScrollbar.call(_self,($this.find(".item").length||10))},400)}});self.$.attr("_rows",showRows)};this.setMultipleChoice=function(changeCallback){var _setMultipleChoice=function(){var _sdSelect=new sdSelect(this),_left,_selectList,_multipleChoiceTopItemObj={};var delItem=function(){var _this=$(this),_value=_this.attr("_value");_sdSelect.$.find(".item[_value='"+_value+"']").removeClass("ched");_this.addClass("del-item");_this.fadeOut(200,function(){$(this).remove();_selectList.stop().animate({top:_sdSelect.$.innerHeight()})})};var getVal=function(){var _this=$(this);retObj={valueArr:[],objArr:[]};_this.find(".left ul .multiple-choice-item:not(.del-item)").each(function(){var $this=$(this);retObj.valueArr.push($this.attr("_value"));retObj.objArr.push({value:$this.attr("_value"),text:$.trim($this.text())})});return retObj};if(!_sdSelect.$.attr("multiple")){_sdSelect.$.prev("select").attr("multiple","multiple");_sdSelect.$.addClass("ismultiple");_sdSelect.$.find(".txt-val").css("width",50).val("");_sdSelect.$.find(".item").each(function(){$(this).html(lib.Replace(_multipleChoiceItem,{text:$.trim($(this).html())}))});_sdSelect.$.attr("multiple","1");_sdSelect.$.find(".right").hide();_sdSelect.$.undelegate("li.item","click");_left=_sdSelect.$.find(".left");_selectList=_sdSelect.$.find(".select-list");_sdSelect.$.delegate("li.item","click",function(event){var _this=$(this),$sel,val,$insetItme,_width;_this.toggleClass("ched");if(!_this.hasClass("ched")){delItem.call(_left.find("ul").find(".multiple-choice-item[_value='"+$.trim(_this.attr("_value"))+"']"))}else{_multipleChoiceTopItemObj._value=$.trim(_this.attr("_value"));_multipleChoiceTopItemObj.text=$.trim(_this.text());$insetItme=$(lib.Replace(_multipleChoiceTopItem,_multipleChoiceTopItemObj));_left.find("ul").append($insetItme);_width=_sdSelect.$.attr("attr-width")-0;if(_width&&$insetItme.outerWidth()>_width){$insetItme.find("span").css({width:_width-50,display:"inline-block",overflow:"hidden"})}_selectList.animate({top:_sdSelect.$.find(".head").innerHeight()})}val=getVal.call(_sdSelect.$);$sel=_sdSelect.$.prev("select").val(val.valueArr);$sel.data("_value",val.objArr);if(typeof changeCallback==="function"){changeCallback(val)}event.stopPropagation();event.preventDefault()});_sdSelect.$.delegate(".head","click",function(event){$(".seltodiv.down").removeClass("down");_sdSelect.$.find(".txt-val").focus();_sdSelect.$.prev("select.seltodiv").click();_sdSelect.$.addClass("down");event.stopPropagation()});_sdSelect.$.delegate(".multiplechoicetopitem-delete","click",function(event){delItem.call($(this).closest(".multiple-choice-item"));event.stopPropagation();event.preventDefault()})}};that.each(function(){var _self=this;if(!$(this).attr("multiple")){setTimeout(function(){_setMultipleChoice.call(_self)},10)}})};this.setWidth=function(thiswidth){that.each(function(){var _self=this,$this=$(this);setTimeout(function(){_fineTuning.call(_self,thiswidth)},100)});that.attr("attr-width",thiswidth)};this.setSkin=function(className){that.addClass(className)}};(function($){$("select.seltodiv").each(function(){_init.call(this)});$("body").delegate("select.seltodiv","click",function(event){event.preventDefault();event.stopPropagation()});$("body").click(function(){$(".seltodiv.down").removeClass("down")});$(".instdiv.seltodiv").find(".item[_disabled]").css("opacity",0.5)})(jQuery);exports.init=function(options1,options2){var _sdSelect;if(typeof options1==="string"){_sdSelect=new sdSelect(".instdiv"+options1);_sdSelect.init(options2);return}if(options1&&options1.constructor==Object){_sdSelect=new sdSelect(".instdiv"+options1.element);if(options1.listData.constructor==Array){_sdSelect.init(options1)}else{}}else{throw"simulation-select.js 的init第一个参数不能为空"}};exports.setShowRows=function(options1,options2){var _sdSelect;if(options1===options1-0){_sdSelect=new sdSelect(".instdiv.seltodiv");_sdSelect.setShowRows(options1);return}if(typeof options1==="string"&&options2===options2-0){_sdSelect=new sdSelect(".instdiv"+options1);_sdSelect.setShowRows(options2);return}if(typeof options1==="object"&&options1.element&&options1.rows){_sdSelect=new sdSelect(".instdiv"+options1.element);_sdSelect.setShowRows(options1.rows);return}throw"simulation-select.js 的setShowRows方法出现异常参数"};exports.setMultipleChoice=function(element){var _sdSelect=new sdSelect(".instdiv"+element);_sdSelect.setMultipleChoice()};exports.add=function(options){if(!options.container){throw"simulation-select.js 的add方法参数对象缺少container，该属性指定插入的容器,可以是jq选择器，dom，jQuery"}if(!options.content){throw"simulation-select.js 的add方法参数对象缺少content，该属性可以是html字符串，dom，jQuery"}var $sel=options.content.constructor==jQuery?options.content:$(options.content),$container=options.container.constructor==jQuery?options.container:$(options.container),_sdSelect;$container.append($sel);_init.call($sel);_sdSelect=new sdSelect($sel.next(".instdiv"));_sdSelect.init(options);return{select:$sel,div:$sel.next(".instdiv")}};exports.setWidth=function(options1,options2){var _sdSelect;if(options1===options1-0){_sdSelect=new sdSelect(".instdiv.seltodiv");_sdSelect.setWidth(options1);return}if(typeof options1==="string"&&options2===options2-0){_sdSelect=new sdSelect(".instdiv"+options1);_sdSelect.setWidth(options2);return}if(typeof options1==="object"&&options1.element&&options1.rows){_sdSelect=new sdSelect(".instdiv"+options1.element);_sdSelect.setWidth(options1.width);return}throw"simulation-select.js 的setWidth方法出现异常参数"}});